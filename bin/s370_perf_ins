#!/usr/bin/perl -w
# $Id: s370_perf_ins 1002 2018-03-29 13:14:31Z mueller $
#
# Copyright 2018- by Walter F.J. Mueller <W.F.J.Mueller@gsi.de>
#
# This program is free software; you may redistribute and/or modify it under
# the terms of the GNU General Public License as published by the Free
# Software Foundation, either version 3, or at your option any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY, without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
# for complete details.
#
#  Revision History:
# Date         Rev Version  Comment
# 2018-03-29  1002   1.0    Initial version
#

use 5.14.0;                                 # require Perl 5.14 or higher
use strict;                                 # require strict checking
use Getopt::Long;

my %opts = ();

GetOptions(\%opts,
           'help'
          )
  or die "bad options";

my %tag2txt;
my %tag2ins;
my $head_ver;
my $head_tbl;

# handle help
if (defined $opts{help}) { do_help();  exit 0; }

while (<>) {
  chomp;
  $head_ver = $_ if m/^s370_perf version:/;
  $head_tbl = $_ if m/^Tag   Comment/;

  if (m/^([DT]\d\d\d)\s+                  # tag
        (.*?)\s+:/x) {                    # txt
    my $tag = $1;
    my $txt = $2;
    $tag2txt{$tag} = $_;
    if (($tag !~ m/^T9\d\d/ && $txt !~ m/;/) && $txt =~ m/(^[A-Z]+)/) {
      $tag2ins{$tag} = $1;
    }
  }
}

my @tlist = sort { $tag2ins{$a} cmp $tag2ins{$b} || $a cmp $b }  keys %tag2ins;

printf "%s\n\n",$head_ver if defined $head_ver;
printf "%s\n"  ,$head_tbl if defined $head_tbl;

foreach my $tag (@tlist) {
  printf "%s\n", $tag2txt{$tag};
}

exit 0;

#
# -- do_help: print help text ------------------------------------------------
#

sub do_help {
  print "usage: s370_perf_ins [OPTIONS] [FILE]...\n";
  print "  -help      help text\n";
  return;
}

